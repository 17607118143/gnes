syntax = "proto2";

package gnes;

message Array {
  // the actual array data, in bytes
  required bytes data = 1;

  // Specifies the shape (dimensions) of an array
  repeated uint32 shape = 2 [packed = true];

  // Specifies the data type of an array
  required string dtype = 3 [default = "float"];
}

message ArrayList {
  repeated Array arrays = 1;
}


message Document {
  // The unique document ID specified by third-party application
  required string id = 1;

  // The actual textual content of the document
  optional string text = 2;

  // Optional, the doc could also hold binary content, e.g., image
  optional Array blob = 3;

  // If true the document has been parsed into several parts
  required bool is_parsed = 4 [default = false];

  // If true the content of document has been encoded as vectors
  required bool is_encoded = 5 [default = false];

  // The uuid generated by the system automatically
  optional string _uuid = 6;

  // The document's text can be parsed/divided into sub-parts (e.g., sentences for text)
  repeated string _parsed_texts = 7;

  // The document blob data can be divided into sub-parts (e.g., patches for an image)
  repeated Array _parsed_blobs = 8;

  message Coordinate {
    repeated uint32 x = 1 [packed = true];
  }
  repeated Coordinate coordinates = 9;

  // The resulted encodes of the document
  repeated Array _encodes = 10;
}

message Query {
  optional string query = 1;
  optional Array blob = 2;
  required bool is_parsed = 3 [default = false];
  required bool is_encoded = 4 [default = false];
  repeated string _parsed_querys = 5;
  repeated Array _parsed_blobs = 6;
  repeated Array encodes = 7;
  optional uint32 top_k = 8 [default = 10];
  optional uint32 time_out = 9;
}

enum Mode {
  QUERY = 0;
  INDEX = 1;
  TRAIN = 2;
}

//SearchRequest represents a search query, with pagination options.
message Request {
  optional Query query = 1;
  repeated Document docs = 2;
  required Mode mode = 3 [default = QUERY];
  optional uint32 _request_id = 4;
}

message SearchResponse {
  message Result {
    required string doc_id = 1;
    required float score = 2;
  }
  repeated Result results = 1;
  required uint32 size = 2;
}

message BaseMessage {
  required uint64 _client_id = 1;
  required uint64 _req_id = 2;
  required string _msg_type = 3;
  required string _route = 4;
  required uint32 _part_id = 5 [default = 0];
  required uint32 _num_part = 6 [default = 1];

  optional Mode mode = 7 [default = QUERY];
  repeated Document docs = 8;
  optional Query query = 9;
  // repeated string logs = 10;

}


